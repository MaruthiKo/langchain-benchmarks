

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Benchmark All Tasks &#8212; LangChain Benchmarks 0.0.10</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/tool_usage/benchmark_all_tasks';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Introduction" href="../extraction/intro.html" />
    <link rel="prev" title="Typewriter: 26 Tools" href="typewriter_26.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">LangChain Benchmarks 0.0.10</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    ü¶úüíØ LangChain Benchmarks
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models.html">Model Registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datasets.html">Datasets</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tool Usage</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="relational_data.html">Relational Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiverse_math.html">Multiverse Math</a></li>
<li class="toctree-l1"><a class="reference internal" href="typewriter_1.html">Typewriter: Single Tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="typewriter_26.html">Typewriter: 26 Tools</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Benchmark All Tasks</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Extraction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../extraction/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extraction/email.html">Email Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extraction/chat_extraction.html">Chat Extraction</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">RAG</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../retrieval/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../retrieval/langchain_docs_qa.html">Q&amp;A over LangChain Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../retrieval/semi_structured_benchmarking/semi_structured.html">Semi-structured RAG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../retrieval/semi_structured_benchmarking/ss_eval_chunk_sizes.html">Semi-structured eval: Chunk size tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../retrieval/semi_structured_benchmarking/ss_eval_long_context.html">Semi-structured eval: Long-context</a></li>
<li class="toctree-l1"><a class="reference internal" href="../retrieval/semi_structured_benchmarking/ss_eval_multi_vector.html">Semi-structured eval: Multi vector</a></li>
<li class="toctree-l1"><a class="reference internal" href="../retrieval/multi_modal_benchmarking/multi_modal_eval_baseline.html">Multi-modal eval: Baseline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../retrieval/multi_modal_benchmarking/multi_modal_eval.html">Multi-modal eval: GPT-4 w/ multi-modal embeddings and multi-vector retriever</a></li>
<li class="toctree-l1"><a class="reference internal" href="../retrieval/comparing_techniques.html">Evaluating RAG Architectures on Benchmark Tasks</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Benchmarking Without LangSmith</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../run_without_langsmith.html">Running Locally</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/langchain-ai/langchain-benchmarks/blob/main/docs/source/notebooks/tool_usage/benchmark_all_tasks.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/langchain-ai/langchain-benchmarks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/langchain-ai/langchain-benchmarks/blob/main/docs/source/notebooks/tool_usage/benchmark_all_tasks.ipynb?plain=1" target="_blank"
   class="btn btn-sm btn-source-file-button dropdown-item"
   title="Show source"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">Show source</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/langchain-ai/langchain-benchmarks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/tool_usage/benchmark_all_tasks.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/tool_usage/benchmark_all_tasks.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Benchmark All Tasks</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run">Run</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inspect">Inspect</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="benchmark-all-tasks">
<h1>Benchmark All Tasks<a class="headerlink" href="#benchmark-all-tasks" title="Permalink to this heading">#</a></h1>
<p>Let‚Äôs benchmark against all tool usage tasks.</p>
<p>Expand the <code class="docutils literal notranslate"><span class="pre">test</span></code> list to benchmark with different models and agent architectures.</p>
<p>Note that this requires <code class="docutils literal notranslate"><span class="pre">langsmith&gt;=0.0.72</span></code> to run the viz parts at the end.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">getpass</span> <span class="kn">import</span> <span class="n">getpass</span>

<span class="c1"># This is just the default list below</span>
<span class="n">required_env_vars</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;LANGCHAIN_API_KEY&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ANYSCALE_API_KEY&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OPENAI_API_KEY&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ANTHROPIC_API_KEY&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">required_env_vars</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">getpass</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provide the required </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The current anthropic tools agent requires the code in https://github.com/anthropics/anthropic-tools/tree/main</span>
<span class="c1"># This will likely change in the near future.</span>
<span class="c1"># To run, clone the repo, install the deps from requirements.txt, then insert into your path</span>
<span class="c1"># import sys</span>
<span class="c1"># sys.path.insert(0, &quot;path/to/anthropic-tools/&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>

<span class="kn">from</span> <span class="nn">langsmith.client</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="kn">from</span> <span class="nn">langchain_benchmarks</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">__version__</span><span class="p">,</span>
    <span class="n">clone_public_dataset</span><span class="p">,</span>
    <span class="n">model_registry</span><span class="p">,</span>
    <span class="n">registry</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">langchain_benchmarks.rate_limiting</span> <span class="kn">import</span> <span class="n">RateLimiter</span>
<span class="kn">from</span> <span class="nn">langchain_benchmarks.tool_usage.agents</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AnthropicToolUserFactory</span><span class="p">,</span>
    <span class="n">CustomAgentFactory</span><span class="p">,</span>
    <span class="n">OpenAIAgentFactory</span><span class="p">,</span>
    <span class="n">OpenAIAssistantFactory</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Prior to starting the tests, you may want to verify
that the task that you‚Äôre working with and the models are propelry defined.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">task</span> <span class="o">=</span> <span class="n">registry</span><span class="p">[</span><span class="s2">&quot;Multiverse Math&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">agent_factory</span> <span class="o">=</span> <span class="n">OpenAIAgentFactory</span><span class="p">(</span>
    <span class="n">task</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;mistral-7b-instruct-v0.1&quot;</span>
<span class="p">)</span>  <span class="c1"># Follows OpenAI function format</span>
<span class="c1"># agent_factory = OpenAIAgentFactory(task, model=&#39;gpt-3.5-turbo-1106&#39;)</span>
<span class="n">agent_factory</span><span class="p">()</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;question&quot;</span><span class="p">:</span> <span class="s2">&quot;(2 + 5) and then to the power of 0.5&quot;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;input&#39;: &#39;(2 + 5) and then to the power of 0.5&#39;,
 &#39;output&#39;: &#39;The answer is 192.54605765894036.&#39;,
 &#39;intermediate_steps&#39;: [(OpenAIToolAgentAction(tool=&#39;add&#39;, tool_input={&#39;a&#39;: 2, &#39;b&#39;: 5}, log=&quot;\nInvoking: `add` with `{&#39;a&#39;: 2, &#39;b&#39;: 5}`\n\n\n&quot;, message_log=[AIMessage(content=&#39;&#39;, additional_kwargs={&#39;tool_calls&#39;: [{&#39;id&#39;: &#39;call_76268389bcf249338904909d8c7d3c5d&#39;, &#39;function&#39;: {&#39;arguments&#39;: &#39;{&quot;a&quot;: 2, &quot;b&quot;: 5}&#39;, &#39;name&#39;: &#39;add&#39;}, &#39;type&#39;: &#39;function&#39;}]})], tool_call_id=&#39;call_76268389bcf249338904909d8c7d3c5d&#39;),
   8.2),
  (OpenAIToolAgentAction(tool=&#39;power&#39;, tool_input={&#39;a&#39;: 8.2, &#39;b&#39;: 0.5}, log=&quot;\nInvoking: `power` with `{&#39;a&#39;: 8.2, &#39;b&#39;: 0.5}`\n\n\n&quot;, message_log=[AIMessage(content=&#39;&#39;, additional_kwargs={&#39;tool_calls&#39;: [{&#39;id&#39;: &#39;call_5a5c579e178e4cc295344da7e9cd51c4&#39;, &#39;function&#39;: {&#39;arguments&#39;: &#39;{&quot;a&quot;: 8.2, &quot;b&quot;: 0.5}&#39;, &#39;name&#39;: &#39;power&#39;}, &#39;type&#39;: &#39;function&#39;}]})], tool_call_id=&#39;call_5a5c579e178e4cc295344da7e9cd51c4&#39;),
   192.54605765894036)]}
</pre></div>
</div>
</div>
</div>
<p>Let‚Äôs make an experiment id</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">experiment_uuid</span> <span class="o">=</span> <span class="s2">&quot;woof&quot;</span>  <span class="c1"># Or generate ranom using uuid.uuid4().hex[:4]</span>
</pre></div>
</div>
</div>
</div>
<p>Define the test cases</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tests</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># 2-tuple of (architecture, model name)</span>
    <span class="p">(</span><span class="s2">&quot;anthropic_tool_user&quot;</span><span class="p">,</span> <span class="s2">&quot;claude-2.1&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;openai_functions&quot;</span><span class="p">,</span> <span class="s2">&quot;mistral-7b-instruct-v0.1&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;openai_functions&quot;</span><span class="p">,</span> <span class="s2">&quot;gpt-3.5-turbo-1106&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;openai_functions&quot;</span><span class="p">,</span> <span class="s2">&quot;gpt-3.5-turbo-0613&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;openai_functions&quot;</span><span class="p">,</span> <span class="s2">&quot;gpt-4-1106-preview&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;openai_functions&quot;</span><span class="p">,</span> <span class="s2">&quot;gpt-4-0613&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;openai_assistant&quot;</span><span class="p">,</span> <span class="s2">&quot;gpt-4-1106-preview&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;openai_assistant&quot;</span><span class="p">,</span> <span class="s2">&quot;gpt-3.5-turbo-1106&quot;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<section id="run">
<h2>Run<a class="headerlink" href="#run" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">uuid</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>  <span class="c1"># Launch langsmith client for cloning datasets</span>
<span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
<span class="n">rate_limiter</span> <span class="o">=</span> <span class="n">RateLimiter</span><span class="p">(</span><span class="n">requests_per_second</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">num_retries</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1"># Whether to delete and re-run test projects that already exist</span>
<span class="c1"># False means skip</span>
<span class="n">overwrite_project</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">overwrite_unfinished</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">registry</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;ToolUsageTask&quot;</span><span class="p">:</span>
        <span class="k">continue</span>

    <span class="n">dataset_name</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">name</span>
    <span class="n">clone_public_dataset</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span> <span class="n">dataset_name</span><span class="o">=</span><span class="n">dataset_name</span><span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">read_dataset</span><span class="p">(</span><span class="n">dataset_name</span><span class="o">=</span><span class="n">dataset_name</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">arch</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Benchmarking </span><span class="si">{</span><span class="n">task</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with model: </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2"> and arch: </span><span class="si">{</span><span class="n">arch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">eval_config</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">get_eval_config</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">arch</span> <span class="o">==</span> <span class="s2">&quot;openai_functions&quot;</span><span class="p">:</span>
            <span class="n">agent_factory</span> <span class="o">=</span> <span class="n">OpenAIAgentFactory</span><span class="p">(</span>
                <span class="n">task</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">rate_limiter</span><span class="o">=</span><span class="n">rate_limiter</span><span class="p">,</span> <span class="n">num_retries</span><span class="o">=</span><span class="n">num_retries</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">arch</span> <span class="o">==</span> <span class="s2">&quot;custom_agent&quot;</span><span class="p">:</span>
            <span class="n">agent_factory</span> <span class="o">=</span> <span class="n">CustomAgentFactory</span><span class="p">(</span>
                <span class="n">task</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">rate_limiter</span><span class="o">=</span><span class="n">rate_limiter</span><span class="p">,</span> <span class="n">num_retries</span><span class="o">=</span><span class="n">num_retries</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">arch</span> <span class="o">==</span> <span class="s2">&quot;anthropic_tool_user&quot;</span><span class="p">:</span>
            <span class="n">agent_factory</span> <span class="o">=</span> <span class="n">AnthropicToolUserFactory</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">arch</span> <span class="o">==</span> <span class="s2">&quot;openai_assistant&quot;</span><span class="p">:</span>
            <span class="n">agent_factory</span> <span class="o">=</span> <span class="n">OpenAIAssistantFactory</span><span class="p">(</span>
                <span class="n">task</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">rate_limiter</span><span class="o">=</span><span class="n">rate_limiter</span><span class="p">,</span> <span class="n">num_retries</span><span class="o">=</span><span class="n">num_retries</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">()</span>
        <span class="n">project_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">arch</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">task</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">today</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">experiment_uuid</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">existing_project</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">existing_project</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">read_project</span><span class="p">(</span><span class="n">project_name</span><span class="o">=</span><span class="n">project_name</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="n">existing_project</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">overwrite_project</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archiving previous project </span><span class="si">{</span><span class="n">existing_project</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">new_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">existing_project</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - Archived[</span><span class="si">{</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">]&quot;</span>
                <span class="n">client</span><span class="o">.</span><span class="n">update_project</span><span class="p">(</span>
                    <span class="n">project_id</span><span class="o">=</span><span class="n">existing_project</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">new_name</span><span class="p">,</span>
                    <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="o">**</span><span class="n">existing_project</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="s2">&quot;archived&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span>
                <span class="n">overwrite_unfinished</span>
                <span class="ow">and</span> <span class="n">existing_project</span><span class="o">.</span><span class="n">end_time</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="n">existing_project</span><span class="o">.</span><span class="n">run_count</span> <span class="o">&lt;</span> <span class="n">dataset</span><span class="o">.</span><span class="n">example_count</span>
            <span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archiving unfinished project </span><span class="si">{</span><span class="n">existing_project</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">new_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">existing_project</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - Archived[</span><span class="si">{</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">]&quot;</span>
                <span class="n">client</span><span class="o">.</span><span class="n">update_project</span><span class="p">(</span>
                    <span class="n">project_id</span><span class="o">=</span><span class="n">existing_project</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">new_name</span><span class="p">,</span>
                    <span class="n">end_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">(),</span>
                    <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="o">**</span><span class="n">existing_project</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="s2">&quot;archived&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping </span><span class="si">{</span><span class="n">project_name</span><span class="si">}</span><span class="s2"> - already run&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
        <span class="n">client</span><span class="o">.</span><span class="n">run_on_dataset</span><span class="p">(</span>
            <span class="n">dataset_name</span><span class="o">=</span><span class="n">dataset_name</span><span class="p">,</span>
            <span class="n">llm_or_chain_factory</span><span class="o">=</span><span class="n">agent_factory</span><span class="p">,</span>
            <span class="n">evaluation</span><span class="o">=</span><span class="n">eval_config</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">project_name</span><span class="o">=</span><span class="n">project_name</span><span class="p">,</span>
            <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="n">model</span><span class="p">],</span>
            <span class="n">concurrency_level</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">project_metadata</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">experiment_uuid</span><span class="p">,</span>
                <span class="s2">&quot;task&quot;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">today</span><span class="p">,</span>
                <span class="s2">&quot;langchain_benchmarks_version&quot;</span><span class="p">:</span> <span class="n">__version__</span><span class="p">,</span>
                <span class="s2">&quot;arch&quot;</span><span class="p">:</span> <span class="n">arch</span><span class="p">,</span>
                <span class="s2">&quot;archived&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="inspect">
<h2>Inspect<a class="headerlink" href="#inspect" title="Permalink to this heading">#</a></h2>
<p>Note that if the queue is under significant load, you may want to wait before running the following to ensure all runs are in the DB and all stats are correctly computed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">langsmith.client</span> <span class="kn">import</span> <span class="n">Client</span>
</pre></div>
</div>
</div>
</div>
<p>Let‚Äôs fetch all the data that has the same experiment ID and place it in a dataframe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">experiment_ids</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;woof&quot;</span><span class="p">]</span>
<span class="n">dataset_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">task</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">registry</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Type</span><span class="o">=</span><span class="s2">&quot;ToolUsageTask&quot;</span><span class="p">)]</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
<span class="n">projects</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">dataset_name</span> <span class="ow">in</span> <span class="n">dataset_names</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">client</span><span class="o">.</span><span class="n">list_projects</span><span class="p">(</span><span class="n">reference_dataset_name</span><span class="o">=</span><span class="n">dataset_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">project</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">experiment_ids</span>
            <span class="ow">and</span> <span class="n">project</span><span class="o">.</span><span class="n">end_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="n">projects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>

<span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">projects</span><span class="p">:</span>
    <span class="c1"># Temporary way to get tag information</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">test_results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_test_results</span><span class="p">(</span><span class="n">project_name</span><span class="o">=</span><span class="n">project</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">project</span><span class="o">.</span><span class="n">run_count</span><span class="p">)</span>
        <span class="k">continue</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">project</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">test_results</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="n">keys</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">test_results</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_results</span><span class="p">)</span>
<span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dfs</span><span class="p">:</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">keys</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">missing</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&quot;None of [&#39;example_id&#39;] are in the columns&quot; 0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/gf/6rnp_mbx5914kx7qmmh7xzmw0000gn/T/ipykernel_60065/1691579366.py:29: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  df = pd.concat(dfs)
</pre></div>
</div>
</div>
</div>
<p>Compute a standardized ‚Äúcorrect‚Äù column. It uses ‚ÄúCorrect Final State‚Äù for tool usage tasks, and ‚Äúcorrectness (which is based on output) for the other tasks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">correct</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="s2">&quot;Typewriter&quot;</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;task&quot;</span><span class="p">]:</span>
        <span class="n">correct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;feedback.Correct Final State&quot;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">correct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;feedback.correctness&quot;</span><span class="p">])</span>

<span class="n">df</span><span class="p">[</span><span class="s2">&quot;correct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">correct</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;correct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Compute some statistics. We‚Äôre using estimating standard error of the mean assuming a bernoulli process.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_correct</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;arch&quot;</span><span class="p">,</span> <span class="s2">&quot;task&quot;</span><span class="p">])[</span><span class="s2">&quot;correct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s2">&quot;num_correct&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">total</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;task&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;arch&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s2">&quot;total&quot;</span><span class="p">)</span>
<span class="n">stats_df</span> <span class="o">=</span> <span class="n">total</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">num_correct</span><span class="p">)</span>
<span class="n">stats_df</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">% c</span><span class="s2">orrect&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats_df</span><span class="p">[</span><span class="s2">&quot;num_correct&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">stats_df</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]</span>
<span class="n">stats_df</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
    <span class="n">stats_df</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">% c</span><span class="s2">orrect&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">stats_df</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">% c</span><span class="s2">orrect&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="n">stats_df</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Tool Usage - Typewriter (1 tool)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Tool Usage - Typewriter (26 tools)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Multiverse Math&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Tool Usage - Relational Data&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">stats_df</span> <span class="o">=</span> <span class="n">stats_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">models</span> <span class="o">=</span> <span class="n">stats_df</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">arches</span> <span class="o">=</span> <span class="n">stats_df</span><span class="p">[</span><span class="s2">&quot;arch&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Plot the result</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tasks</span><span class="p">))</span>  <span class="c1"># the label locations</span>
<span class="n">width</span> <span class="o">=</span> <span class="mf">0.08</span>  <span class="c1"># the width of the bars</span>
<span class="n">multiplier</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s2">&quot;constrained&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">colormap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;Set2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">colors</span>
<span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">arch</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="n">arches</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">stats_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">model</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;arch&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">arch</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;task&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tasks</span><span class="p">]</span>
    <span class="n">measurement</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">% c</span><span class="s2">orrect&quot;</span><span class="p">]</span>

    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">measurement</span><span class="p">]</span>

    <span class="n">offset</span> <span class="o">=</span> <span class="n">width</span> <span class="o">*</span> <span class="n">multiplier</span> <span class="o">*</span> <span class="mf">1.4</span>
    <span class="n">rects</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
        <span class="n">x</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span>
        <span class="n">values</span><span class="p">,</span>
        <span class="n">width</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">arch</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
        <span class="n">yerr</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar_label</span><span class="p">(</span><span class="n">rects</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">multiplier</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="c1"># Add some text for labels, title and custom x-axis tick labels, etc.</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;% Questions Answered Correctly&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Tool Usage Performance&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">width</span> <span class="o">+</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">tasks</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Model&quot;</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;overall_perf.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/41c32bbe64e3f7da917391789c987ea24b2a90f2094ffb7367ed810e2b1c255f.png" src="../../_images/41c32bbe64e3f7da917391789c987ea24b2a90f2094ffb7367ed810e2b1c255f.png" />
</div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="typewriter_26.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Typewriter: 26 Tools</p>
      </div>
    </a>
    <a class="right-next"
       href="../extraction/intro.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Introduction</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run">Run</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inspect">Inspect</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Langchain AI
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      ¬© Copyright 2023, Langchain AI.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>